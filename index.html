<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8">
    <title>Flying points demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #F0F0F0;
        }
    </style>
</head>

<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.rawgit.com/konvajs/konva/0.10.0/konva.min.js"></script>
<script src="/bower_components/flying-points/flying-points.js"></script>

<div id="container"></div>

<script>
    var width = window.innerWidth;
    var height = window.innerHeight;
    
    var field = new Field('container', width, height);

</script>
<script>
  var socket = io();
  var count = 0;
  function getRandomInt (min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  var colors = ['red', 'green', 'yellow', 'black', 'blue'];

  var calls = {};
  socket.on('data', function (data) {
  	console.log('count', count);
  	if (data.subevent == 'Begin') {
  		
  		var point = new Point(getRandomInt(10,30), getRandomInt(10,30), getRandomInt(-10,10), getRandomInt(-10,10), colors[getRandomInt(0,4)]);


  		if (calls[data.uniqueid] == null) {
  			calls[data.uniqueid] = field.add(point);
  			console.log('add');
  			count++;
  		}
  	} else if (data.subevent == 'End') {
  		if (calls[data.uniqueid]) {
  			field.remove(calls[data.uniqueid]);
  			delete calls[data.uniqueid];
  			console.log('remove');
  			count--;
  		}
  	};
  })
</script>